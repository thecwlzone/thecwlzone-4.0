---
import Pagination from '@/components/Pagination.astro'
import PostsList from '@/components/PostsList.astro'
import PageLayout, {
  type Props as PageLayoutProps
} from '@/layouts/PageLayout.astro'
import config from '@/theme.config'
import { getPosts } from '@/util/posts'
import type { GetStaticPaths, InferGetStaticPropsType } from 'astro'

import { Image } from 'astro:assets'
import authorImage from '../../assets/images/posts/deepai-thecwlzone-desktop.jpg'

export const getStaticPaths = (async ({ paginate }) => {
  const posts = await getPosts()

  return paginate(posts, { pageSize: config.postsPerPage })
}) satisfies GetStaticPaths

type Props = InferGetStaticPropsType<typeof getStaticPaths>

const { page } = Astro.props

const frontmatter: PageLayoutProps['frontmatter'] = {
  title: 'Posts',
  activeHeaderLink: 'Blog',
  canonicalURL: new URL('/posts/1/', Astro.site).toString()
}
---

<PageLayout {frontmatter}>
  <h1>
    {frontmatter.title}
  </h1>

  <Image
    src={authorImage}
    alt="An AI generated man sitting in front of The CWL Zone Home Office"
  />
  <em>
    The CWL Zone World Headquarters. The seated man is an AI generated image.
  </em>

  <PostsList posts={page.data} />

  <Pagination slot="bottom" page={page} />
</PageLayout>
